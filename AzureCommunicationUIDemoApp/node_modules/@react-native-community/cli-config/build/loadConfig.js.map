{"version":3,"names":["getDependencyConfig","root","dependencyName","finalConfig","config","userConfig","isPlatform","merge","name","platforms","Object","keys","reduce","dependency","platform","platformConfig","dependencyConfig","dependencies","loadConfig","projectRoot","findProjectRoot","lazyProject","readConfigFromDisk","initialConfig","reactNativePath","path","resolve","resolveReactNativePath","commands","healthChecks","project","projectConfig","Array","from","Set","findDependencies","acc","localDependencyRoot","resolveNodeModuleDir","readDependencyConfigFromDisk","length","assign"],"sources":["../src/loadConfig.ts"],"sourcesContent":["import path from 'path';\nimport {\n  UserDependencyConfig,\n  ProjectConfig,\n  DependencyConfig,\n  UserConfig,\n  Config,\n} from '@react-native-community/cli-types';\nimport {\n  findProjectRoot,\n  resolveNodeModuleDir,\n} from '@react-native-community/cli-tools';\nimport findDependencies from './findDependencies';\nimport resolveReactNativePath from './resolveReactNativePath';\nimport {\n  readConfigFromDisk,\n  readDependencyConfigFromDisk,\n} from './readConfigFromDisk';\nimport assign from './assign';\nimport merge from './merge';\n\nfunction getDependencyConfig(\n  root: string,\n  dependencyName: string,\n  finalConfig: Config,\n  config: UserDependencyConfig,\n  userConfig: UserConfig,\n  isPlatform: boolean,\n): DependencyConfig {\n  return merge(\n    {\n      root,\n      name: dependencyName,\n      platforms: Object.keys(finalConfig.platforms).reduce(\n        (dependency, platform) => {\n          const platformConfig = finalConfig.platforms[platform];\n          dependency[platform] =\n            // Linking platforms is not supported\n            isPlatform || !platformConfig\n              ? null\n              : platformConfig.dependencyConfig(\n                  root,\n                  config.dependency.platforms[platform],\n                );\n          return dependency;\n        },\n        {} as Config['platforms'],\n      ),\n    },\n    userConfig.dependencies[dependencyName] || {},\n  ) as DependencyConfig;\n}\n\n/**\n * Loads CLI configuration\n */\nfunction loadConfig(projectRoot: string = findProjectRoot()): Config {\n  let lazyProject: ProjectConfig;\n  const userConfig = readConfigFromDisk(projectRoot);\n\n  const initialConfig: Config = {\n    root: projectRoot,\n    get reactNativePath() {\n      return userConfig.reactNativePath\n        ? path.resolve(projectRoot, userConfig.reactNativePath)\n        : resolveReactNativePath(projectRoot);\n    },\n    dependencies: userConfig.dependencies,\n    commands: userConfig.commands,\n    healthChecks: [],\n    platforms: userConfig.platforms,\n    get project() {\n      if (lazyProject) {\n        return lazyProject;\n      }\n\n      lazyProject = {};\n      for (const platform in finalConfig.platforms) {\n        const platformConfig = finalConfig.platforms[platform];\n        if (platformConfig) {\n          lazyProject[platform] = platformConfig.projectConfig(\n            projectRoot,\n            userConfig.project[platform] || {},\n          );\n        }\n      }\n\n      return lazyProject;\n    },\n  };\n\n  const finalConfig = Array.from(\n    new Set([\n      ...Object.keys(userConfig.dependencies),\n      ...findDependencies(projectRoot),\n    ]),\n  ).reduce((acc: Config, dependencyName) => {\n    const localDependencyRoot =\n      userConfig.dependencies[dependencyName] &&\n      userConfig.dependencies[dependencyName].root;\n\n    try {\n      let root =\n        localDependencyRoot ||\n        resolveNodeModuleDir(projectRoot, dependencyName);\n      let config = readDependencyConfigFromDisk(root, dependencyName);\n\n      const isPlatform = Object.keys(config.platforms).length > 0;\n\n      return assign({}, acc, {\n        dependencies: assign({}, acc.dependencies, {\n          get [dependencyName](): DependencyConfig {\n            return getDependencyConfig(\n              root,\n              dependencyName,\n              finalConfig,\n              config,\n              userConfig,\n              isPlatform,\n            );\n          },\n        }),\n        commands: [...acc.commands, ...config.commands],\n        platforms: {\n          ...acc.platforms,\n          ...config.platforms,\n        },\n        healthChecks: [...acc.healthChecks, ...config.healthChecks],\n      }) as Config;\n    } catch {\n      return acc;\n    }\n  }, initialConfig);\n\n  return finalConfig;\n}\n\nexport default loadConfig;\n"],"mappings":"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"}