{"version":3,"names":["tryInstallAppOnDevice","args","adbPath","device","androidProject","appName","sourceDir","variant","mode","toLowerCase","pathToApk","binaryPath","buildDirectory","apkFile","getInstallApkName","adbArgs","logger","info","debug","execa","sync","stdio","error","CLIError","availableCPUs","adb","getAvailableCPUs","availableCPU","concat","apkName","fs","existsSync"],"sources":["../../../src/commands/runAndroid/tryInstallAppOnDevice.ts"],"sourcesContent":["import execa from 'execa';\nimport fs from 'fs';\nimport {logger, CLIError} from '@react-native-community/cli-tools';\n\nimport adb from './adb';\nimport type {AndroidProject, Flags} from './';\n\nfunction tryInstallAppOnDevice(\n  args: Flags,\n  adbPath: string,\n  device: string,\n  androidProject: AndroidProject,\n) {\n  try {\n    // \"app\" is usually the default value for Android apps with only 1 app\n    const {appName, sourceDir} = androidProject;\n    const variant = (args.mode || 'debug').toLowerCase();\n\n    let pathToApk;\n    if (!args.binaryPath) {\n      const buildDirectory = `${sourceDir}/${appName}/build/outputs/apk/${variant}`;\n      const apkFile = getInstallApkName(\n        appName,\n        adbPath,\n        variant,\n        device,\n        buildDirectory,\n      );\n      pathToApk = `${buildDirectory}/${apkFile}`;\n    } else {\n      pathToApk = args.binaryPath;\n    }\n\n    const adbArgs = ['-s', device, 'install', '-r', '-d', pathToApk];\n    logger.info(`Installing the app on the device \"${device}\"...`);\n    logger.debug(\n      `Running command \"cd android && adb -s ${device} install -r -d ${pathToApk}\"`,\n    );\n    execa.sync(adbPath, adbArgs, {stdio: 'inherit'});\n  } catch (error) {\n    throw new CLIError('Failed to install the app on the device.', error);\n  }\n}\n\nfunction getInstallApkName(\n  appName: string,\n  adbPath: string,\n  variant: string,\n  device: string,\n  buildDirectory: string,\n) {\n  const availableCPUs = adb.getAvailableCPUs(adbPath, device);\n\n  // check if there is an apk file like app-armeabi-v7a-debug.apk\n  for (const availableCPU of availableCPUs.concat('universal')) {\n    const apkName = `${appName}-${availableCPU}-${variant}.apk`;\n    if (fs.existsSync(`${buildDirectory}/${apkName}`)) {\n      return apkName;\n    }\n  }\n\n  // check if there is a default file like app-debug.apk\n  const apkName = `${appName}-${variant}.apk`;\n  if (fs.existsSync(`${buildDirectory}/${apkName}`)) {\n    return apkName;\n  }\n\n  throw new CLIError('Could not find the correct install APK file.');\n}\n\nexport default tryInstallAppOnDevice;\n"],"mappings":";;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;AAAwB;AAGxB,SAASA,qBAAqB,CAC5BC,IAAW,EACXC,OAAe,EACfC,MAAc,EACdC,cAA8B,EAC9B;EACA,IAAI;IACF;IACA,MAAM;MAACC,OAAO;MAAEC;IAAS,CAAC,GAAGF,cAAc;IAC3C,MAAMG,OAAO,GAAG,CAACN,IAAI,CAACO,IAAI,IAAI,OAAO,EAAEC,WAAW,EAAE;IAEpD,IAAIC,SAAS;IACb,IAAI,CAACT,IAAI,CAACU,UAAU,EAAE;MACpB,MAAMC,cAAc,GAAI,GAAEN,SAAU,IAAGD,OAAQ,sBAAqBE,OAAQ,EAAC;MAC7E,MAAMM,OAAO,GAAGC,iBAAiB,CAC/BT,OAAO,EACPH,OAAO,EACPK,OAAO,EACPJ,MAAM,EACNS,cAAc,CACf;MACDF,SAAS,GAAI,GAAEE,cAAe,IAAGC,OAAQ,EAAC;IAC5C,CAAC,MAAM;MACLH,SAAS,GAAGT,IAAI,CAACU,UAAU;IAC7B;IAEA,MAAMI,OAAO,GAAG,CAAC,IAAI,EAAEZ,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,IAAI,EAAEO,SAAS,CAAC;IAChEM,kBAAM,CAACC,IAAI,CAAE,qCAAoCd,MAAO,MAAK,CAAC;IAC9Da,kBAAM,CAACE,KAAK,CACT,yCAAwCf,MAAO,kBAAiBO,SAAU,GAAE,CAC9E;IACDS,gBAAK,CAACC,IAAI,CAAClB,OAAO,EAAEa,OAAO,EAAE;MAACM,KAAK,EAAE;IAAS,CAAC,CAAC;EAClD,CAAC,CAAC,OAAOC,KAAK,EAAE;IACd,MAAM,KAAIC,oBAAQ,EAAC,0CAA0C,EAAED,KAAK,CAAC;EACvE;AACF;AAEA,SAASR,iBAAiB,CACxBT,OAAe,EACfH,OAAe,EACfK,OAAe,EACfJ,MAAc,EACdS,cAAsB,EACtB;EACA,MAAMY,aAAa,GAAGC,YAAG,CAACC,gBAAgB,CAACxB,OAAO,EAAEC,MAAM,CAAC;;EAE3D;EACA,KAAK,MAAMwB,YAAY,IAAIH,aAAa,CAACI,MAAM,CAAC,WAAW,CAAC,EAAE;IAC5D,MAAMC,OAAO,GAAI,GAAExB,OAAQ,IAAGsB,YAAa,IAAGpB,OAAQ,MAAK;IAC3D,IAAIuB,aAAE,CAACC,UAAU,CAAE,GAAEnB,cAAe,IAAGiB,OAAQ,EAAC,CAAC,EAAE;MACjD,OAAOA,OAAO;IAChB;EACF;;EAEA;EACA,MAAMA,OAAO,GAAI,GAAExB,OAAQ,IAAGE,OAAQ,MAAK;EAC3C,IAAIuB,aAAE,CAACC,UAAU,CAAE,GAAEnB,cAAe,IAAGiB,OAAQ,EAAC,CAAC,EAAE;IACjD,OAAOA,OAAO;EAChB;EAEA,MAAM,KAAIN,oBAAQ,EAAC,8CAA8C,CAAC;AACpE;AAAC,eAEcvB,qBAAqB;AAAA"}